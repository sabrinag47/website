---
title: "Project2: Modeling, Testing & Predicting"
date: 2019-11-27
output: html_document
---



<p>##Project 2
##Sabrina Guerra (smg4255)</p>
<p>##Introduction
<em>The dataset I selected was chosen as it meet the criteria of 5 variables, 1 being categorical and 2 being numeric. The dataset I selected was about the extinction of birds. The variables include the species name, the averagetime of extinction on the British islands, the average number of nesting pairs, size, and status. The size is broken up into the categories of large or small. The status is a categorical variable that includes resident or migrant. The time and nesting variables are numeric. I was interested in this dataset because as a biology major, I am interested in the conservation of species of animals that are endangered and could become extict.</em></p>
<pre class="r"><code>library(LearnBayes)

bird&lt;-birdextinct
bird</code></pre>
<pre><code>##                 species   time nesting size status
## 1           Sparrowhawk  3.030   1.000    0      1
## 2               Buzzard  5.464   2.000    0      1
## 3               Kestrel  4.098   1.210    0      1
## 4             Peregrine  1.681   1.125    0      1
## 5        Grey_partridge  8.850   5.167    0      1
## 6                 Quail  1.493   1.000    0      0
## 7  Red-legged_partridge  7.692   2.750    0      1
## 8              Pheasant  3.846   5.630    0      1
## 9            Water_rail 16.667   3.000    0      1
## 10            Corncrake  4.219   4.670    0      0
## 11              Moorhen  8.130   4.056    0      1
## 12                 Coot  5.000   1.000    0      1
## 13              Lapwing  7.299   6.960    0      0
## 14        Golden_plover  1.000   1.670    0      0
## 15        Ringed_plover 27.027   5.560    0      1
## 16               Curlew  3.106   2.830    0      0
## 17             Redshank  4.000   4.375    0      0
## 18                Snipe 16.129   4.125    0      0
## 19           Stock_dove  3.484   3.670    0      1
## 20            Rock_dove 37.037   8.330    0      1
## 21          Wood_pigeon  7.299   2.750    0      1
## 22               Cuckoo  2.525   1.430    0      0
## 23      Short-eared_owl  4.132   2.000    0      1
## 24           Little_owl  2.000   2.750    0      1
## 25               Magpie 10.000   4.500    0      1
## 26              Jackdaw  2.667   7.120    0      1
## 27         Carrion_crow  4.587   4.580    0      1
## 28                Raven 58.824   2.350    0      1
## 29              Skylark 32.258   6.870    1      1
## 30              Swallow  2.571   3.830    1      0
## 31         House_martin  2.160   5.000    1      0
## 32       Yellow_wagtail  1.000   1.250    1      0
## 33         Pied_wagtail  2.967   2.270    1      1
## 34         Meadow_pipit  9.524   5.350    1      1
## 35                 Wren 11.111   8.700    1      1
## 36              Dunnock  7.299   6.100    1      1
## 37                Robin  4.000   3.330    1      1
## 38            Stonechat  2.381   3.640    1      1
## 39             Wheatear  2.611   4.830    1      0
## 40            Blackbird  3.257   4.670    1      1
## 41          Song_thrush  1.701   1.700    1      1
## 42        Mistle_thrush  1.795   1.330    1      1
## 43  Grasshopper_warbler  1.198   1.000    1      0
## 44        Sedge_warbler  3.185   1.900    1      0
## 45          Whitethroat  2.273   4.420    1      0
## 46       Willow_warbler  1.111   1.250    1      0
## 47           Chiffchaff  1.000   1.000    1      0
## 48            Goldcrest  1.000   1.000    1      1
## 49   Spotted_flycatcher  1.230   1.000    1      0
## 50            Great_tit  6.061   2.500    1      1
## 51             Blue_tit  3.175   1.500    1      1
## 52         Yellowhammer  2.000   2.500    1      1
## 53         Reed_bunting  5.076   5.630    1      1
## 54            Chaffinch  1.934   2.370    1      1
## 55            Goldfinch  1.493   1.500    1      1
## 56              Redpoll  1.000   1.000    1      1
## 57               Linnet  5.102   6.500    1      1
## 58        House_sparrow  3.003   4.500    1      1
## 59         Tree_sparrow  1.898   2.170    1      1
## 60             Starling 41.667  11.620    1      1
## 61      Pied_flycatcher  1.000   1.000    1      0
## 62               Siskin  1.000   1.000    1      1</code></pre>
<p>##MANOVA</p>
<pre class="r"><code>man1&lt;-manova(cbind(time,nesting)~status, data=bird)
summary.aov(man1)</code></pre>
<pre><code>##  Response time :
##             Df Sum Sq Mean Sq F value  Pr(&gt;F)  
## status       1  405.2  405.19  3.6983 0.05922 .
## Residuals   60 6573.7  109.56                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
##  Response nesting :
##             Df  Sum Sq Mean Sq F value Pr(&gt;F)
## status       1   9.824  9.8245  1.8737 0.1762
## Residuals   60 314.602  5.2434</code></pre>
<pre class="r"><code>man2&lt;-manova(cbind(time,nesting)~size, data=bird)
summary.aov(man2)</code></pre>
<pre><code>##  Response time :
##             Df Sum Sq Mean Sq F value Pr(&gt;F)
## size         1  287.9  287.94  2.5821 0.1133
## Residuals   60 6690.9  111.52               
## 
##  Response nesting :
##             Df Sum Sq Mean Sq F value Pr(&gt;F)
## size         1   0.24  0.2449  0.0453 0.8321
## Residuals   60 324.18  5.4030</code></pre>
<p><em>For the MANOVAs performed above, the p values are all greater than 0.05 meaning these values are not significant.The MANOVAs compare the relationships between nesting and time to size for the first one and nesting, tim and status in the second.</em>
<em>The assumptions for MANOVAs include: 1. random, independent observations, 2. multivariate normality of dependent variables, 3. homogeneity of covariance matrices, 4. linear relationships between the dependent variable, 5. no extreme outliers, and 6. no multicollinearity. Some of these assumptions are met as they are from different islands, but there are outliers and could be correlational. </em>
<em>The number of tests that would have been performed if the results had been significant would be 1 MANOVA + 2 ANOVA + 4 t-tests since there are 2 numeric values and two categorical, each with two levels. That is a total of 7 tests.</em></p>
<p>##Randomization Test</p>
<pre class="r"><code>pairwise.t.test(bird$time, bird$status, p.adj = &quot;none&quot;)</code></pre>
<pre><code>## 
##  Pairwise comparisons using t tests with pooled SD 
## 
## data:  bird$time and bird$status 
## 
##   0    
## 1 0.059
## 
## P value adjustment method: none</code></pre>
<pre class="r"><code>pairwise.t.test(bird$time, bird$size, p.adj = &quot;none&quot;)</code></pre>
<pre><code>## 
##  Pairwise comparisons using t tests with pooled SD 
## 
## data:  bird$time and bird$size 
## 
##   0   
## 1 0.11
## 
## P value adjustment method: none</code></pre>
<pre class="r"><code>rand_dist&lt;-vector() 

for(i in 1:5000){ 
  new&lt;-data.frame(time=sample(bird$time),size=bird$size)
  rand_dist[i]&lt;-mean(new[new$size==&quot;1&quot;,]$time) 
  mean(new[new$size==&quot;0&quot;,]$time)
}

library(tidyverse)</code></pre>
<pre><code>## -- Attaching packages -----------------</code></pre>
<pre><code>## v ggplot2 3.2.1     v purrr   0.3.3
## v tibble  2.1.3     v dplyr   0.8.3
## v tidyr   1.0.0     v stringr 1.4.0
## v readr   1.3.1     v forcats 0.4.0</code></pre>
<pre><code>## -- Conflicts --------------------------
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>bird%&gt;%group_by(size)%&gt;%
  summarize(means=mean(time))%&gt;%
  summarize(`mean_diff:`=diff(means))</code></pre>
<pre><code>## # A tibble: 1 x 1
##   `mean_diff:`
##          &lt;dbl&gt;
## 1        -4.33</code></pre>
<pre class="r"><code>{hist(rand_dist,main=&quot;&quot;,ylab=&quot;&quot;); abline(v = -4.330437,col=&quot;red&quot;)}</code></pre>
<p><img src="/Project2_files/figure-html/unnamed-chunk-5-1.png" width="672" />
<em>Above, one can observe a randmization test. This simulates the randomization of data 5000 tmes to observe mean time, which in this case is the amount of time of extinction for the 62 bird species in this dataset from the British islands.</em>
<em>In this study, the null hypothesis is that there is no significant difference between the bird popultions due to size.</em>
<em>The alternatve hypothesis is that there is a significant difference.</em></p>
<p>##Linear Regression Model</p>
<pre class="r"><code>fit&lt;-lm(time~nesting, data=bird) 
summary(fit)</code></pre>
<pre><code>## 
## Call:
## lm(formula = time ~ nesting, data = bird)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -12.737  -5.070  -0.959   0.531  54.300 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -0.8365     2.1437  -0.390    0.698    
## nesting       2.2810     0.5214   4.375 4.92e-05 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 9.391 on 60 degrees of freedom
## Multiple R-squared:  0.2419, Adjusted R-squared:  0.2292 
## F-statistic: 19.14 on 1 and 60 DF,  p-value: 4.92e-05</code></pre>
<pre class="r"><code>coef(fit)</code></pre>
<pre><code>## (Intercept)     nesting 
##  -0.8365311   2.2809502</code></pre>
<pre class="r"><code>library(ggplot2)
ggplot(bird, aes(x=nesting, y=time,group=status))+geom_point(aes(color=status))+  geom_smooth(method=&quot;lm&quot;,formula=y~1,se=F,fullrange=T,aes(color=status))+xlab(&quot;nesting&quot;)</code></pre>
<p><img src="/Project2_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<pre class="r"><code>ggplot(bird, aes(x=nesting, y=time,group=size))+geom_point(aes(color=size))+  geom_smooth(method=&quot;lm&quot;,formula=y~1,se=F,fullrange=T,aes(color=size))+xlab(&quot;nesting&quot;)</code></pre>
<p><img src="/Project2_files/figure-html/unnamed-chunk-6-2.png" width="672" />
<em>The coefficients can be interpreted as the slope of the linear regression or relationship between the variables of nesting and time in the dataset. The first graph displays the linear regression between time and nesting and the different color points indicate status(resident r migrant). The second graph shows the same relationship but with the color points showing the size of the bird (large or small).</em></p>
<pre class="r"><code>library(sandwich); library(lmtest)</code></pre>
<pre><code>## Loading required package: zoo</code></pre>
<pre><code>## 
## Attaching package: &#39;zoo&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     as.Date, as.Date.numeric</code></pre>
<pre class="r"><code>bptest(fit)</code></pre>
<pre><code>## 
##  studentized Breusch-Pagan test
## 
## data:  fit
## BP = 0.41283, df = 1, p-value = 0.5205</code></pre>
<pre class="r"><code>summary(fit)$coef[,1:2]</code></pre>
<pre><code>##               Estimate Std. Error
## (Intercept) -0.8365311  2.1436968
## nesting      2.2809502  0.5213538</code></pre>
<pre class="r"><code>coeftest(fit, vcov=vcovHC(fit))[,1:2]</code></pre>
<pre><code>##               Estimate Std. Error
## (Intercept) -0.8365311  2.3514194
## nesting      2.2809502  0.7274227</code></pre>
<p><em>Heteroskedasticity assumption is checked through the bptest() and it is shown to exist through the p value displayed. The linear regression model is recomputed with robust standard errors through the coeftest(fit,vcov=vcovHC(fit))</em>
<em>Changes are observed before and after the robust standard error computation.The estimate remain the same but testandard error increases by about 0.2 when observing the relationship between time and nesting.</em></p>
<p>##Regression Model with Bootstrapped Errors</p>
<pre class="r"><code>means&lt;-vector() 
for(i in 1:5000){ 
  samp&lt;-sample(bird$time,replace=T) 
  means[i]&lt;-mean(samp) 
  }

quantile(means,c(.025, .975))</code></pre>
<pre><code>##     2.5%    97.5% 
## 4.628605 9.979675</code></pre>
<pre class="r"><code>ggplot()+geom_histogram(aes(means))+geom_vline(xintercept=quantile(means,c(.025,.975)))</code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="/Project2_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code>bootse&lt;-function(x,n=5000){  
  means&lt;-vector()  
  for(i in 1:n){    
    means[i]&lt;- mean(sample(x,replace=T))  
  }  
  return(sd(means)) 
}

mean_se&lt;-bird%&gt;%group_by(size)%&gt;%summarize(mean_time=mean(time),se=bootse(time)) 
mean_se</code></pre>
<pre><code>## # A tibble: 2 x 3
##    size mean_time    se
##   &lt;int&gt;     &lt;dbl&gt; &lt;dbl&gt;
## 1     0      9.33  2.30
## 2     1      5.00  1.43</code></pre>
<pre class="r"><code>ggplot(mean_se, aes(x=size,y=mean_time))+geom_bar(stat=&quot;identity&quot;)+                           geom_errorbar(aes(ymax=mean_time+se, ymin=mean_time-se), width=.5)</code></pre>
<p><img src="/Project2_files/figure-html/unnamed-chunk-8-2.png" width="672" />
<em>The first graph indicates the 95th percentile. Next, the standard error and mean time are calculated per size of the animal (1=large, 0=small).The bar graph compares mean times based on time and depicts the bootstrapping/error bars. It isshown that small birds have a higher average time of extinction on the islands than large birds (the difference is about 4.3).</em></p>
<pre class="r"><code>fit6&lt;-lm(time~size+nesting,data=bird)
fitvals&lt;-fit6$fitted.value

resids&lt;-fit6$residuals 
fitted&lt;-fit6$fitted.values  
ggplot()+geom_point(aes(fitvals,resids))+geom_hline(yintercept=0, color=&#39;red&#39;)</code></pre>
<p><img src="/Project2_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code>resid_resamp&lt;-replicate(5000,{    
  new_resids&lt;-sample(resids,replace=TRUE)     
  bird$new_y&lt;-fitted+new_resids    
  fit6&lt;-lm(time~size+nesting,data=bird)     
  coef(fit6) 
  })</code></pre>
<p><em>This graph depicts the homoskedasticity and linearity assumptions of the data.</em></p>
<p>##Logistic Regression</p>
<pre class="r"><code>fit2&lt;-glm(size~., family=&quot;binomial&quot;, data=bird) 
coeftest(fit2)</code></pre>
<pre><code>## 
## z test of coefficients:
## 
##                                Estimate  Std. Error z value Pr(&gt;|z|)
## (Intercept)                  2.6566e+01  3.5612e+05   1e-04   0.9999
## speciesBlue_tit              4.4131e-06  5.0363e+05   0e+00   1.0000
## speciesBuzzard              -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesCarrion_crow         -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesChaffinch             4.4200e-06  5.0363e+05   0e+00   1.0000
## speciesChiffchaff            4.4236e-06  5.0363e+05   0e+00   1.0000
## speciesCoot                 -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesCorncrake            -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesCuckoo               -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesCurlew               -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesDunnock               3.0110e-09  5.0363e+05   0e+00   1.0000
## speciesGoldcrest             4.6202e-06  5.0363e+05   0e+00   1.0000
## speciesGolden_plover        -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesGoldfinch             4.4195e-06  5.0363e+05   0e+00   1.0000
## speciesGrasshopper_warbler   4.6149e-06  5.0363e+05   0e+00   1.0000
## speciesGreat_tit             8.7880e-09  5.0363e+05   0e+00   1.0000
## speciesGrey_partridge       -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesHouse_martin          4.6219e-06  5.0363e+05   0e+00   1.0000
## speciesHouse_sparrow        -5.5186e-09  5.0363e+05   0e+00   1.0000
## speciesJackdaw              -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesKestrel              -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesLapwing              -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesLinnet                6.5125e-09  5.0363e+05   0e+00   1.0000
## speciesLittle_owl           -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesMagpie               -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesMeadow_pipit          8.3038e-09  5.0363e+05   0e+00   1.0000
## speciesMistle_thrush         4.4109e-06  5.0363e+05   0e+00   1.0000
## speciesMoorhen              -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesPeregrine            -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesPheasant             -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesPied_flycatcher       3.1698e-09  5.0363e+05   0e+00   1.0000
## speciesPied_wagtail          4.6184e-06  5.0363e+05   0e+00   1.0000
## speciesQuail                -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesRaven                -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesRed-legged_partridge -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesRedpoll               4.4159e-06  5.0363e+05   0e+00   1.0000
## speciesRedshank             -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesReed_bunting         -4.6927e-09  5.0363e+05   0e+00   1.0000
## speciesRinged_plover        -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesRobin                 4.6221e-06  5.0363e+05   0e+00   1.0000
## speciesRock_dove            -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesSedge_warbler         4.4253e-06  5.0363e+05   0e+00   1.0000
## speciesShort-eared_owl      -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesSiskin                4.6196e-06  5.0363e+05   0e+00   1.0000
## speciesSkylark               4.4103e-06  5.0363e+05   0e+00   1.0000
## speciesSnipe                -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesSong_thrush           4.4176e-06  5.0363e+05   0e+00   1.0000
## speciesSparrowhawk          -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesSpotted_flycatcher    4.4134e-06  5.0363e+05   0e+00   1.0000
## speciesStarling              4.6202e-06  5.0363e+05   0e+00   1.0000
## speciesStock_dove           -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesStonechat             2.1885e-09  5.0363e+05   0e+00   1.0000
## speciesSwallow               3.9014e-09  5.0363e+05   0e+00   1.0000
## speciesTree_sparrow         -1.9484e-07  5.0363e+05   0e+00   1.0000
## speciesWater_rail           -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesWheatear             -2.9171e-09  5.0363e+05   0e+00   1.0000
## speciesWhitethroat           4.4251e-06  5.0363e+05   0e+00   1.0000
## speciesWillow_warbler        4.4145e-06  5.0363e+05   0e+00   1.0000
## speciesWood_pigeon          -5.3132e+01  5.0363e+05  -1e-04   0.9999
## speciesWren                  4.4208e-06  5.0363e+05   0e+00   1.0000
## speciesYellow_wagtail        4.6188e-06  5.0363e+05   0e+00   1.0000
## speciesYellowhammer          4.6170e-06  5.0363e+05   0e+00   1.0000
## time                                 NA          NA      NA       NA
## nesting                              NA          NA      NA       NA
## status                               NA          NA      NA       NA</code></pre>
<pre class="r"><code>fit3&lt;-glm(status~time, family=&quot;binomial&quot;, data=bird) 
coeftest(fit3)</code></pre>
<pre><code>## 
## z test of coefficients:
## 
##             Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept) 0.055277   0.460524  0.1200   0.9045
## time        0.171195   0.105680  1.6199   0.1052</code></pre>
<pre class="r"><code>bird2&lt;-bird%&gt;%
  transmute(species,                         
            time,                         
            nesting,                         
            status,                         
            outcome=size,                         
            y=as.numeric(outcome))
bird2$outcome&lt;-factor(bird2$outcome,levels=c(&quot;large&quot;,&quot;small&quot;))
pca1&lt;-princomp(bird[c(&#39;time&#39;,&#39;nesting&#39;,&#39;size&#39;)])
bird2$predictor&lt;-pca1$scores[,1]
                                                                                                         
fit4&lt;-glm(y~predictor,data=bird2,family=&quot;binomial&quot;) 
bird2$prob&lt;-predict(fit4,type=&quot;response&quot;)


ggplot(bird2, aes(predictor,prob))+geom_point(alpha=.5,size=3)</code></pre>
<p><img src="/Project2_files/figure-html/unnamed-chunk-10-1.png" width="672" />
<em>The coeffcients listed above are the slopes which indiate the relationship between time and size, and time with status.A breakdown by species can be observed for each of the 62 birds.</em></p>
<pre class="r"><code>library(plotROC)


prob1&lt;-predict(fit4,type=&quot;response&quot;)  
pred&lt;-ifelse(prob1&gt;.5,1,0) 
table(truth=bird$size, prediction=pred)%&gt;%addmargins</code></pre>
<pre><code>##      prediction
## truth  0  1 Sum
##   0    5 23  28
##   1    3 31  34
##   Sum  8 54  62</code></pre>
<pre class="r"><code>sens&lt;-function(p,data=bird, y=y) mean(bird[bird$y==1,]$prob1&gt;p) 
spec&lt;-function(p,data=bird, y=y) mean(bird[bird$y==0,]$prob1&lt;p) 
sensitivity&lt;-sapply(seq(0,1,.01),sens,bird) 
specificity&lt;-sapply(seq(0,1,.01),spec,bird)


#Interactions
exp(coef(fit4))</code></pre>
<pre><code>## (Intercept)   predictor 
##    1.200947    0.957943</code></pre>
<pre class="r"><code>ROCplot&lt;-ggplot(bird)+geom_roc(aes(d=size,m=prob1), n.cuts=0)+  geom_segment(aes(x=0,xend=1,y=0,yend=1),lty=2) 
ROCplot</code></pre>
<p><img src="/Project2_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="r"><code>library(glmnet)</code></pre>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: &#39;Matrix&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:tidyr&#39;:
## 
##     expand, pack, unpack</code></pre>
<pre><code>## Loaded glmnet 3.0-1</code></pre>
<pre class="r"><code>class_diag&lt;-function(probs,truth){ 
  tab&lt;-table(factor(probs&gt;.5,levels=c(&quot;FALSE&quot;,&quot;TRUE&quot;)),truth)  
  acc=sum(diag(tab))/sum(tab)  
  sens=tab[2,2]/colSums(tab)[2]  
  spec=tab[1,1]/colSums(tab)[1]  
  ppv=tab[2,2]/rowSums(tab)[2]  
  if(is.numeric(truth)==FALSE &amp; is.logical(truth)==FALSE) 
    truth&lt;-as.numeric(truth)-1  
  ord&lt;-order(probs, decreasing=TRUE)  
  probs &lt;- probs[ord]; truth &lt;- truth[ord]  
  TPR=cumsum(truth)/max(1,sum(truth))   
  FPR=cumsum(!truth)/max(1,sum(!truth))  
  dup&lt;-c(probs[-1]&gt;=probs[-length(probs)], FALSE)  
  TPR&lt;-c(0,TPR[!dup],1); FPR&lt;-c(0,FPR[!dup],1)  
  n &lt;- length(TPR)  
  auc&lt;- sum( ((TPR[-1]+TPR[-n])/2) * (FPR[-1]-FPR[-n]) )  
  data.frame(acc,sens,spec,ppv,auc)
  } 

prob&lt;-predict(fit4,type=&quot;response&quot;)

class_diag(prob,bird2$y)</code></pre>
<pre><code>##         acc      sens      spec       ppv      auc
## 1 0.5806452 0.9117647 0.1785714 0.5740741 0.730042</code></pre>
<p><em>The AUC fo this data was 0.73 with accuracy of.58, sensitivity of .9117 and specificity of .1786.</em></p>
<pre class="r"><code>k=5 
data1&lt;-bird2[sample(nrow(bird2)),]
folds&lt;-cut(seq(1:nrow(bird2)),breaks=k,labels=F)
diags&lt;-NULL 
for(i in 1:k){ 
  train&lt;-data1[folds!=i,]   
  test&lt;-data1[folds==i,]  
  truth&lt;-test$y 
  fit&lt;-glm(y~status,data=train,family=&quot;binomial&quot;)  
  probs&lt;-predict(fit,newdata = test,type=&quot;response&quot;)  
  diags&lt;-rbind(diags,class_diag(probs,truth)) 
}

apply(diags,2,mean)</code></pre>
<pre><code>##       acc      sens      spec       ppv       auc 
## 0.3679487 0.5765873 0.2800000 0.4710256 0.4179762</code></pre>
<p><em>The 10 fold CV reveals the AUC is 0.4140476 with accuracy of .4820513, senstivity of.9 and specificity of 0.</em></p>
<p>##LASSO Regression</p>
<pre class="r"><code>library(glmnet)
x&lt;-model.matrix(fit2)
y&lt;-as.matrix(bird2$status)
cv&lt;-cv.glmnet(x,y,family=&quot;binomial&quot;) 
lasso&lt;-glmnet(x,y,family=&quot;binomial&quot;,lambda=cv$lambda.1se) 
coef(lasso)</code></pre>
<pre><code>## 66 x 1 sparse Matrix of class &quot;dgCMatrix&quot;
##                                    s0
## (Intercept)                 -4.917257
## (Intercept)                  .       
## speciesBlue_tit              .       
## speciesBuzzard               .       
## speciesCarrion_crow          .       
## speciesChaffinch             .       
## speciesChiffchaff            .       
## speciesCoot                  .       
## speciesCorncrake             .       
## speciesCuckoo                .       
## speciesCurlew                .       
## speciesDunnock               .       
## speciesGoldcrest             .       
## speciesGolden_plover         .       
## speciesGoldfinch             .       
## speciesGrasshopper_warbler   .       
## speciesGreat_tit             .       
## speciesGrey_partridge        .       
## speciesHouse_martin          .       
## speciesHouse_sparrow         .       
## speciesJackdaw               .       
## speciesKestrel               .       
## speciesLapwing               .       
## speciesLinnet                .       
## speciesLittle_owl            .       
## speciesMagpie                .       
## speciesMeadow_pipit          .       
## speciesMistle_thrush         .       
## speciesMoorhen               .       
## speciesPeregrine             .       
## speciesPheasant              .       
## speciesPied_flycatcher       .       
## speciesPied_wagtail          .       
## speciesQuail                 .       
## speciesRaven                 .       
## speciesRed-legged_partridge  .       
## speciesRedpoll               .       
## speciesRedshank              .       
## speciesReed_bunting          .       
## speciesRinged_plover         .       
## speciesRobin                 .       
## speciesRock_dove             .       
## speciesSedge_warbler         .       
## speciesShort-eared_owl       .       
## speciesSiskin                .       
## speciesSkylark               .       
## speciesSnipe                 .       
## speciesSong_thrush           .       
## speciesSparrowhawk           .       
## speciesSpotted_flycatcher    .       
## speciesStarling              .       
## speciesStock_dove            .       
## speciesStonechat             .       
## speciesSwallow               .       
## speciesTree_sparrow          .       
## speciesWater_rail            .       
## speciesWheatear              .       
## speciesWhitethroat           .       
## speciesWillow_warbler        .       
## speciesWood_pigeon           .       
## speciesWren                  .       
## speciesYellow_wagtail        .       
## speciesYellowhammer          .       
## time                         .       
## nesting                      .       
## status                      10.655353</code></pre>
<p><em>In the lasso, one can observe thatstatus is correlated with time.</em></p>
<p>##Conclusion
<em>In conclusion, it is hard to determine which variables create an effect on the amount of time a species wil be present on the island. It does seem that there is a correlation between time and size, and time and status.</em></p>
